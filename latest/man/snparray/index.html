



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Compressed storage for SNP data">
      
      
      
        <meta name="author" content="Hua Zhou">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.2">
    
    
      
        <title>SnpArray - SnpArrays.jl</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.ba0fd1a6.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../assets/Documenter.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#snparray" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="SnpArrays.jl" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                SnpArrays.jl
              </span>
              <span class="md-header-nav__topic">
                SnpArray
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/OpenMendel/SnpArrays.jl/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    SnpArrays.jl
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/OpenMendel/SnpArrays.jl/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Manual
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Manual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        SnpArray
      </label>
    
    <a href="./" title="SnpArray" class="md-nav__link md-nav__link--active">
      SnpArray
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#constructor" title="Constructor" class="md-nav__link">
    Constructor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-statistics" title="Summary statistics" class="md-nav__link">
    Summary statistics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering" title="Filtering" class="md-nav__link">
    Filtering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#random-genotypes-generation" title="Random genotypes generation" class="md-nav__link">
    Random genotypes generation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subsetting" title="Subsetting" class="md-nav__link">
    Subsetting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment" title="Assignment" class="md-nav__link">
    Assignment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convert-copy-and-imputation" title="Convert, copy and imputation" class="md-nav__link">
    Convert, copy and imputation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#empirical-kinship-matrix" title="Empirical kinship matrix" class="md-nav__link">
    Empirical kinship matrix
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#principal-components" title="Principal components" class="md-nav__link">
    Principal components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linear-algebra-with-snparray" title="Linear algebra with SnpArray" class="md-nav__link">
    Linear algebra with SnpArray
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../snpdata/" title="SnpData" class="md-nav__link">
      SnpData
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../haplotypearray/" title="HaplotypeArray" class="md-nav__link">
      HaplotypeArray
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#constructor" title="Constructor" class="md-nav__link">
    Constructor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-statistics" title="Summary statistics" class="md-nav__link">
    Summary statistics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering" title="Filtering" class="md-nav__link">
    Filtering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#random-genotypes-generation" title="Random genotypes generation" class="md-nav__link">
    Random genotypes generation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subsetting" title="Subsetting" class="md-nav__link">
    Subsetting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assignment" title="Assignment" class="md-nav__link">
    Assignment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convert-copy-and-imputation" title="Convert, copy and imputation" class="md-nav__link">
    Convert, copy and imputation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#empirical-kinship-matrix" title="Empirical kinship matrix" class="md-nav__link">
    Empirical kinship matrix
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#principal-components" title="Principal components" class="md-nav__link">
    Principal components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linear-algebra-with-snparray" title="Linear algebra with SnpArray" class="md-nav__link">
    Linear algebra with SnpArray
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/OpenMendel/SnpArrays.jl/edit/master/docs/man/snparray.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <p><a id='SnpArray-1'></a></p>
<h1 id="snparray">SnpArray</h1>
<p><code>SnpArray</code> is an array of <code>Tuple{Bool,Bool}</code> and adopts the same coding as the <a href="http://zzz.bwh.harvard.edu/plink/binary.shtml">Plink binary format</a>. If <code>A1</code> and <code>A2</code> are the two alleles, the coding rule is  </p>
<table>
<thead>
<tr>
<th align="center">Genotype</th>
<th align="center">SnpArray</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">A1,A1</td>
<td align="center">(false,false)</td>
</tr>
<tr>
<td align="center">A1,A2</td>
<td align="center">(false,true)</td>
</tr>
<tr>
<td align="center">A2,A2</td>
<td align="center">(true,true)</td>
</tr>
<tr>
<td align="center">missing</td>
<td align="center">(true,false)</td>
</tr>
</tbody>
</table>
<p>The code <code>(true,false)</code> is reserved for missing genotype. Otherwise, the bit <code>true</code> represents one copy of allele <code>A2</code>. In a two-dimensional <code>SnpArray</code>, each row is a person and each column is a SNP.</p>
<p>For complete genotype data, for example, after imputation, consider using the <a href="../haplotypearray/#HaplotypeArray-1">HaplotypeArray</a> type.</p>
<p><a id='Constructor-1'></a></p>
<h2 id="constructor">Constructor</h2>
<p>There are various ways to initialize a <code>SnpArray</code>.  </p>
<ul>
<li><code>SnpArray</code> can be initialized from <a href="http://zzz.bwh.harvard.edu/plink/binary.shtml">Plink binary files</a>, say the sample data set <code>hapmap3</code> in package <code>docs</code> folder:</li>
</ul>
<div class="codehilite"><pre><span></span><span class="p">;</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">$</span><span class="p">(</span><span class="n">Pkg</span><span class="o">.</span><span class="n">dir</span><span class="p">(</span><span class="s">&quot;SnpArrays&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="s">&quot;/docs/hapmap3.*&quot;</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>-rw-r--r--  1 huazhou  staff  1128171 Jun 19  2017 /Users/huazhou/.julia/v0.6/SnpArrays/docs/hapmap3.bed
-rw-r--r--  1 huazhou  staff   388672 Jun 19  2017 /Users/huazhou/.julia/v0.6/SnpArrays/docs/hapmap3.bim
-rw-r--r--  1 huazhou  staff     7136 Jun 19  2017 /Users/huazhou/.julia/v0.6/SnpArrays/docs/hapmap3.fam
-rw-r--r--  1 huazhou  staff   332960 Jun 19  2017 /Users/huazhou/.julia/v0.6/SnpArrays/docs/hapmap3.map
</pre></div>


<div class="codehilite"><pre><span></span><span class="k">using</span> <span class="n">SnpArrays</span>
<span class="n">hapmap</span> <span class="o">=</span> <span class="n">SnpArray</span><span class="p">(</span><span class="n">Pkg</span><span class="o">.</span><span class="n">dir</span><span class="p">(</span><span class="s">&quot;SnpArrays&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="s">&quot;/docs/hapmap3&quot;</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>[1m[36mINFO: [39m[22m[36mv1.0 BED file detected
[39m




324×13928 SnpArrays.SnpArray{2}:
 (true, true)  (true, true)   (false, false)  …  (true, true)   (true, true)
 (true, true)  (false, true)  (false, true)      (false, true)  (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (false, true)  (true, true)    …  (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)       (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)   …  (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)       (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 ⋮                                            ⋱                             
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)  …  (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)       (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)  …  (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
</pre></div>


<p>By default, the constructor figures out the number of individuals and SNPs from the <code>.bim</code> and <code>.fam</code> files.</p>
<div class="codehilite"><pre><span></span><span class="c"># rows are people; columns are SNPs</span>
<span class="n">people</span><span class="p">,</span> <span class="n">snps</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">hapmap</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>(324, 13928)
</pre></div>


<p>Alternatively, users can supply keyword arguments <code>people</code> and <code>snps</code> to the constructor. In this case only the <code>.bed</code> file needs to be present.</p>
<div class="codehilite"><pre><span></span><span class="n">hapmap</span> <span class="o">=</span> <span class="n">SnpArray</span><span class="p">(</span><span class="n">Pkg</span><span class="o">.</span><span class="n">dir</span><span class="p">(</span><span class="s">&quot;SnpArrays&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="s">&quot;/docs/hapmap3&quot;</span><span class="p">;</span> <span class="n">people</span> <span class="o">=</span> <span class="mi">324</span><span class="p">,</span> <span class="n">snps</span> <span class="o">=</span> <span class="mi">13928</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>[1m[36mINFO: [39m[22m[36mv1.0 BED file detected
[39m




324×13928 SnpArrays.SnpArray{2}:
 (true, true)  (true, true)   (false, false)  …  (true, true)   (true, true)
 (true, true)  (false, true)  (false, true)      (false, true)  (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (false, true)  (true, true)    …  (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)       (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)   …  (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)       (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 ⋮                                            ⋱                             
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)  …  (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)       (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)  …  (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
</pre></div>


<p>Internally <code>SnpArray</code> stores data as <code>BitArray</code>s and consumes approximately the same amount of memory as the Plink <code>bed</code> file size.</p>
<div class="codehilite"><pre><span></span><span class="c"># memory usage, bed file size</span>
<span class="n">Base</span><span class="o">.</span><span class="n">summarysize</span><span class="p">(</span><span class="n">hapmap</span><span class="p">),</span> <span class="n">filesize</span><span class="p">(</span><span class="s">&quot;hapmap3.bed&quot;</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>(1128256, 1128171)
</pre></div>


<ul>
<li><code>SnpArray</code> can be initialized from a matrix of A2 allele counts.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">SnpArray</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">0</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span>5×3 SnpArrays.SnpArray{2}:
 (false, true)   (true, true)    (false, true)
 (false, true)   (true, true)    (true, true) 
 (false, true)   (true, true)    (true, true) 
 (false, false)  (false, false)  (true, true) 
 (true, true)    (false, true)   (true, true)
</pre></div>


<ul>
<li><code>SnpArray(m, n)</code> generates an m by n <code>SnpArray</code> of all A1 alleles.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">SnpArray</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>5×3 SnpArrays.SnpArray{2}:
 (false, false)  (false, false)  (false, false)
 (false, false)  (false, false)  (false, false)
 (false, false)  (false, false)  (false, false)
 (false, false)  (false, false)  (false, false)
 (false, false)  (false, false)  (false, false)
</pre></div>


<p><a id='Summary-statistics-1'></a></p>
<h2 id="summary-statistics">Summary statistics</h2>
<p><code>summarize</code> function computes the following summary statistics of a <code>SnpArray</code>:  </p>
<ul>
<li><code>maf</code>: minor allele frequencies, taking into account of missingness.</li>
<li><code>minor_allele</code>: a <code>BitVector</code> indicating the minor allele for each SNP.   <code>minor_allele[j]==true</code> means A1 is the minor allele for SNP j; <code>minor_allele[j]==false</code> means A2 is the minor allele for SNP j.</li>
<li><code>missings_by_snp</code>: number of missing genotypes for each snp.</li>
<li><code>missings_by_person</code>: number of missing genotypes for each person.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">maf</span><span class="p">,</span> <span class="n">minor_allele</span><span class="p">,</span> <span class="n">missings_by_snp</span><span class="p">,</span> <span class="n">missings_by_person</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">hapmap</span><span class="p">)</span>
<span class="c"># minor allele frequencies</span>
<span class="n">maf</span>
</pre></div>


<div class="codehilite"><pre><span></span>13928-element Array{Float64,1}:
 0.0       
 0.0776398 
 0.324074  
 0.191589  
 0.441358  
 0.0       
 0.00462963
 0.453704  
 0.226852  
 0.14486   
 0.0       
 0.483025  
 0.25387   
 ⋮         
 0.239938  
 0.239938  
 0.255486  
 0.23913   
 0.238318  
 0.310937  
 0.23913   
 0.23913   
 0.23913   
 0.00154321
 0.0417957 
 0.00617284
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># total number of missing genotypes</span>
<span class="n">sum</span><span class="p">(</span><span class="n">missings_by_snp</span><span class="p">),</span> <span class="n">sum</span><span class="p">(</span><span class="n">missings_by_person</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>(11894, 11894)
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># proportion of missing genotypes</span>
<span class="n">sum</span><span class="p">(</span><span class="n">missings_by_snp</span><span class="p">)</span> <span class="o">/</span> <span class="n">length</span><span class="p">(</span><span class="n">hapmap</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>0.0026356890108565393
</pre></div>


<p><a id='Filtering-1'></a></p>
<h2 id="filtering">Filtering</h2>
<p>In almost all analyses, SNPs and individuals with low genotyping success rates are ignored. This filtering step is an important tool for removing likely false positives from association testing, as genotyping failure often occurs preferentially in cases or controls, or is correlated with the quantitative trait. <code>filter(s, min_success_rate_per_snp, min_success_rate_per_person)</code> does filtering according to the specified success rates for SNPs and people. Default is 0.98 for both.</p>
<div class="codehilite"><pre><span></span><span class="c"># filtering SNPs and people to have both success rates above 0.98</span>
<span class="n">snp_idx</span><span class="p">,</span> <span class="n">person_idx</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">hapmap</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">)</span>
<span class="c"># summary statistics of the filtered SnpArray</span>
<span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">missings_by_snp_filtered</span><span class="p">,</span> <span class="n">missings_by_person_filtered</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">hapmap</span><span class="p">[</span><span class="n">person_idx</span><span class="p">,</span> <span class="n">snp_idx</span><span class="p">]);</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># minimum SNP genotyping success rate after filtering ≥ 0.98</span>
<span class="mi">1</span> <span class="o">-</span> <span class="n">maximum</span><span class="p">(</span><span class="n">missings_by_snp_filtered</span><span class="p">)</span> <span class="o">/</span> <span class="n">length</span><span class="p">(</span><span class="n">missings_by_person_filtered</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>0.9813084112149533
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># minimum individual genotyping success rate after filtering ≥ 0.98</span>
<span class="mi">1</span> <span class="o">-</span> <span class="n">maximum</span><span class="p">(</span><span class="n">missings_by_person_filtered</span><span class="p">)</span> <span class="o">/</span> <span class="n">length</span><span class="p">(</span><span class="n">missings_by_snp_filtered</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>0.9818511796733213
</pre></div>


<p><a id='Random-genotypes-generation-1'></a></p>
<h2 id="random-genotypes-generation">Random genotypes generation</h2>
<p><code>randgeno(a1freq)</code> generates a random genotype according to A1 allele frequency <code>a1freq</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">randgeno</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>(false, false)
</pre></div>


<p><code>randgeno(maf, minor_allele)</code> generates a random genotype according to minor allele frequency <code>maf</code> and whether the minor allele is A1 (<code>minor_allele==true</code>) or A2 (<code>minor_allele==false</code>).</p>
<div class="codehilite"><pre><span></span><span class="n">randgeno</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>(true, true)
</pre></div>


<p><code>randgeno(n, maf, minor_allele)</code> generates a vector of random genotypes according to a common minor allele frequency <code>maf</code> and the minor allele.</p>
<div class="codehilite"><pre><span></span><span class="n">randgeno</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>10-element SnpArrays.SnpArray{1}:
 (false, true) 
 (false, true) 
 (false, true) 
 (false, true) 
 (true, true)  
 (true, true)  
 (false, false)
 (true, true)  
 (false, true) 
 (false, true)
</pre></div>


<p><code>randgeno(m, n, maf, minor_allele)</code> generates a random $m$-by-$n$ <code>SnpArray</code> according to a vector of minor allele frequencies <code>maf</code> and a minor allele indicator vector. The lengths of both vectors should be <code>n</code>.</p>
<div class="codehilite"><pre><span></span><span class="c"># this is a random replicate of the hapmap data</span>
<span class="n">randgeno</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">hapmap</span><span class="p">),</span> <span class="n">maf</span><span class="p">,</span> <span class="n">minor_allele</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>324×13928 SnpArrays.SnpArray{2}:
 (true, true)  (true, true)   (true, true)   …  (true, true)   (true, true)
 (true, true)  (false, true)  (false, true)     (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)      (false, true)  (true, true)
 (true, true)  (true, true)   (true, true)      (true, true)   (true, true)
 (true, true)  (false, true)  (true, true)      (true, true)   (true, true)
 (true, true)  (false, true)  (false, true)  …  (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)     (true, true)   (true, true)
 (true, true)  (false, true)  (false, true)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)  …  (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)      (true, true)   (true, true)
 ⋮                                           ⋱                             
 (true, true)  (false, true)  (false, true)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)     (true, true)   (true, true)
 (true, true)  (false, true)  (true, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)   …  (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)     (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)   …  (true, true)   (true, true)
 (true, true)  (false, true)  (true, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)     (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)      (true, true)   (true, true)
</pre></div>


<p><a id='Subsetting-1'></a></p>
<h2 id="subsetting">Subsetting</h2>
<p>Subsetting a <code>SnpArray</code> works the same way as subsetting any other arrays.</p>
<div class="codehilite"><pre><span></span><span class="c"># genotypes of the 1st person</span>
<span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>13928-element SnpArrays.SnpArray{1}:
 (true, true)  
 (true, true)  
 (false, false)
 (true, true)  
 (true, true)  
 (true, true)  
 (false, true) 
 (false, true) 
 (true, true)  
 (false, true) 
 (true, true)  
 (true, true)  
 (false, false)
 ⋮             
 (false, true) 
 (false, true) 
 (true, true)  
 (false, true) 
 (false, true) 
 (false, true) 
 (false, true) 
 (false, true) 
 (false, true) 
 (true, true)  
 (true, true)  
 (true, true)
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># genotypes of the 5th SNP</span>
<span class="n">hapmap</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>324-element SnpArrays.SnpArray{1}:
 (true, true)  
 (true, true)  
 (false, true) 
 (false, true) 
 (true, true)  
 (false, false)
 (false, false)
 (true, true)  
 (true, true)  
 (true, true)  
 (true, true)  
 (true, true)  
 (false, true) 
 ⋮             
 (false, false)
 (true, true)  
 (false, true) 
 (true, true)  
 (true, true)  
 (true, true)  
 (true, true)  
 (true, true)  
 (false, true) 
 (true, true)  
 (true, true)  
 (true, true)
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># subsetting both persons and SNPs</span>
<span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="o">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>5×6 SnpArrays.SnpArray{2}:
 (true, true)   (true, true)  (false, true)  …  (true, true)   (false, true)
 (true, true)   (true, true)  (true, true)      (true, true)   (false, true)
 (false, true)  (true, true)  (true, true)      (false, true)  (true, true) 
 (false, true)  (true, true)  (true, true)      (true, true)   (false, true)
 (true, true)   (true, true)  (true, true)      (true, true)   (false, true)
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># filter out rare SNPs with MAF &lt; 0.05</span>
<span class="n">hapmap</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">maf</span> <span class="o">.≥</span> <span class="mf">0.05</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>324×12085 SnpArrays.SnpArray{2}:
 (true, true)   (false, false)  …  (false, true)  (false, true)
 (false, true)  (false, true)      (true, true)   (true, true) 
 (true, true)   (false, true)      (true, true)   (true, true) 
 (true, true)   (false, true)      (false, true)  (false, true)
 (true, true)   (false, true)      (true, true)   (true, true) 
 (false, true)  (true, true)    …  (false, true)  (false, true)
 (true, true)   (true, true)       (true, true)   (true, true) 
 (true, true)   (false, false)     (true, true)   (true, true) 
 (true, true)   (false, true)      (true, true)   (true, true) 
 (true, true)   (false, true)      (false, true)  (false, true)
 (true, true)   (false, true)   …  (true, true)   (true, true) 
 (true, true)   (true, true)       (false, true)  (false, true)
 (true, true)   (false, false)     (false, true)  (false, true)
 ⋮                              ⋱                              
 (true, true)   (false, true)      (false, true)  (false, true)
 (true, true)   (false, false)     (false, true)  (false, true)
 (true, true)   (false, false)     (true, true)   (true, true) 
 (true, true)   (false, false)  …  (true, true)   (true, true) 
 (true, true)   (false, true)      (true, true)   (true, true) 
 (true, true)   (true, true)       (false, true)  (false, true)
 (true, true)   (false, true)      (false, true)  (false, true)
 (true, true)   (false, true)      (true, true)   (true, true) 
 (true, true)   (false, false)  …  (false, true)  (false, true)
 (true, true)   (false, true)      (false, true)  (false, true)
 (true, true)   (false, false)     (false, true)  (false, true)
 (true, true)   (false, false)     (true, true)   (true, true)
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># filter out individuals with genotyping success rate &lt; 0.90</span>
<span class="n">hapmap</span><span class="p">[</span><span class="n">missings_by_person</span> <span class="o">/</span> <span class="n">people</span> <span class="o">.&lt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>220×13928 SnpArrays.SnpArray{2}:
 (true, true)  (true, true)   (false, false)  …  (true, true)   (true, true)
 (true, true)  (false, true)  (false, true)      (false, true)  (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)       (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)   …  (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (false, true)  (false, true)   …  (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)       (true, true)   (true, true)
 (true, true)  (true, true)   (true, true)       (true, true)   (true, true)
 ⋮                                            ⋱                             
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)  …  (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)   …  (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, true)      (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
 (true, true)  (true, true)   (false, false)     (true, true)   (true, true)
</pre></div>


<p><code>view</code> creates views of subarray without copying data and improve efficiency in many calculations.</p>
<div class="codehilite"><pre><span></span><span class="n">mafcommon</span><span class="p">,</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">view</span><span class="p">(</span><span class="n">hapmap</span><span class="p">,</span> <span class="o">:</span><span class="p">,</span> <span class="n">maf</span> <span class="o">.≥</span> <span class="mf">0.05</span><span class="p">))</span>
<span class="n">mafcommon</span>
</pre></div>


<div class="codehilite"><pre><span></span>12085-element Array{Float64,1}:
 0.0776398
 0.324074 
 0.191589 
 0.441358 
 0.453704 
 0.226852 
 0.14486  
 0.483025 
 0.25387  
 0.109907 
 0.221875 
 0.475232 
 0.305556 
 ⋮        
 0.253125 
 0.238318 
 0.235016 
 0.239938 
 0.239938 
 0.255486 
 0.23913  
 0.238318 
 0.310937 
 0.23913  
 0.23913  
 0.23913
</pre></div>


<p><a id='Assignment-1'></a></p>
<h2 id="assignment">Assignment</h2>
<p>It is possible to assign specific genotypes to a <code>SnpArray</code> entry.</p>
<div class="codehilite"><pre><span></span><span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>(true, true)
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>(false, true)
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NaN</span>
<span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>(true, false)
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>(true, true)
</pre></div>


<p>Subsetted assignment such as <code>hapmap[:, 1] = Nan</code> is also valid.</p>
<p><a id='Convert,-copy-and-imputation-1'></a></p>
<h2 id="convert-copy-and-imputation">Convert, copy and imputation</h2>
<p>In most analyses we convert a whole <code>SnpArray</code> or slices of it to numeric arrays (matrix of <strong>minor allele counts</strong>) for statistical analysis. Keep in mind that the storage of resultant data can be up to 32 fold larger than that of the original <code>SnpArray</code>. Fortunately, rich collection of data types in <code>Julia</code> allow us choose one that fits into memory. Below are estimates of memory usage for some common data types with <code>n</code> persons and <code>p</code> SNPs. Here MAF denotes the <strong>average</strong> minor allele frequencies.</p>
<ul>
<li><code>SnpArray</code>: $0.25np$ bytes</li>
<li><code>Matrix{Int8}</code>: $np$ bytes</li>
<li><code>Matrix{Float16}</code>: $2np$ bytes</li>
<li><code>Matrix{Float32}</code>: $4np$ bytes</li>
<li><code>Matrix{Float64}</code>: $8np$ bytes</li>
<li><code>SparseMatrixCSC{Float64,Int64}</code>: $16 \cdot \text{NNZ} + 8(p+1) \approx 16np(2\text{MAF}(1-\text{MAF})+\text{MAF}^2) + 8(p+1) = 16np \cdot \text{MAF}(2-\text{MAF}) + 8(p+1)$ bytes. When the average MAF=0.25, this is about $7np$ bytes. When MAF=0.025, this is about $0.8np$ bypes, 10 fold smaller than the <code>Matrix{Float64}</code> type.</li>
<li><code>SparseMatrixCSC{Int8,UInt32}</code>: $5 \cdot \text{NNZ} + 4(p+1) \approx 5np(2\text{MAF}(1-\text{MAF})+\text{MAF}^2) + 4(p+1) = 5np \cdot \text{MAF}(2-\text{MAF}) + 4(p+1)$ bytes. When the average MAF=0.25, this is about $2.2np$ bytes. When MAF=0.08, this is about $0.8np$ bypes, 10 fold smaller than <code>Matrix{Float64}</code> type.</li>
<li>Two <code>SparseMatrixCSC{Bool,Int64}</code>: $2np \cdot \text{MAF} \cdot 9 + 16(p+1) = 18 np \cdot \text{MAF} + 16(p+1)$ bytes. When the average MAF=0.25, this is about $4.5np$ bytes. When MAF=0.045, this is about $0.8np$ bytes, 10 fold smaller than <code>Matrix{Float64}</code> type.</li>
</ul>
<p>To be concrete, consider 2 typical data sets:  </p>
<ul>
<li>COPD (GWAS): $n = 6670$ individuals, $p = 630998$ SNPs, average MAF is 0.2454.</li>
<li>GAW19 (sequencing study): $n = 959$ individuals, $p = 8348674$ SNPs, average MAF is 0.085.</li>
</ul>
<table>
<thead>
<tr>
<th align="right">Data Type</th>
<th align="right">COPD</th>
<th align="right">GAW19</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right"><code>SnpArray</code></td>
<td align="right">1.05GB</td>
<td align="right">2GB</td>
</tr>
<tr>
<td align="right"><code>Matrix{Float64}</code></td>
<td align="right">33.67GB</td>
<td align="right">64.05GB</td>
</tr>
<tr>
<td align="right"><code>SparseMatrixCSC{Float64,Int64}</code></td>
<td align="right">29GB</td>
<td align="right">20.82GB</td>
</tr>
<tr>
<td align="right"><code>SparseMatrixCSC{Bool,Int64}</code></td>
<td align="right">18.6GB</td>
<td align="right">12.386GB</td>
</tr>
</tbody>
</table>
<p>Apparently for data sets with a majority of rare variants, converting to sparse matrices saves memory and often brings computational advantages too. In the <code>SparseMatrixCSC</code> format, the integer type of the row indices <code>rowval</code> and column pointer <code>colptr</code> should have maximal allowable value larger than the number of nonzeros in the matrix. The <code>InexactError()</code> error encountered during conversion often indicates that the integer type has a too small range. The utility function <code>estimatesize</code> conveniently estimates memory usage in bytes for the input data type.</p>
<div class="codehilite"><pre><span></span><span class="c"># estimated memory usage if convert to Matrix{Float64}</span>
<span class="n">estimatesize</span><span class="p">(</span><span class="n">people</span><span class="p">,</span> <span class="n">snps</span><span class="p">,</span> <span class="kt">Matrix</span><span class="p">{</span><span class="kt">Float64</span><span class="p">})</span>
</pre></div>


<div class="codehilite"><pre><span></span>3.6101376e7
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># convert to Matrix{Float64}</span>
<span class="n">hapmapf64</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="kt">Matrix</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span> <span class="n">hapmap</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>324×13928 Array{Float64,2}:
 0.0  0.0  2.0  0.0  0.0  0.0  1.0  1.0  …  1.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  1.0  1.0  1.0  0.0  0.0  0.0  1.0     0.0  0.0  0.0  0.0  0.0  1.0  0.0
 0.0  0.0  1.0  1.0  1.0  0.0  0.0  2.0     1.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  1.0  0.0  1.0  0.0  0.0  1.0     1.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  1.0  1.0  0.0  0.0  0.0  2.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  1.0  0.0  0.0  2.0  0.0  0.0  0.0  …  2.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  2.0  0.0  0.0  2.0     1.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  2.0  0.0  0.0  0.0  0.0  1.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  1.0  1.0  0.0  0.0  0.0  2.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  1.0  0.0  0.0  0.0  0.0  2.0     1.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  1.0  0.0  0.0  0.0  0.0  2.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  1.0  0.0  0.0  0.0  2.0     1.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  2.0  0.0  1.0  0.0  0.0  1.0     2.0  1.0  1.0  1.0  0.0  0.0  0.0
 ⋮                        ⋮              ⋱                      ⋮            
 0.0  0.0  1.0  0.0  2.0  0.0  0.0  1.0     2.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  2.0  0.0  0.0  0.0  0.0  2.0     2.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  2.0  0.0  1.0  0.0  0.0  1.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  2.0  1.0  0.0  0.0  0.0  1.0  …  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  1.0  0.0  0.0  0.0  0.0  1.0     1.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  1.0  0.0  0.0  0.0  1.0     2.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  1.0  1.0  0.0  0.0  0.0  2.0     1.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  1.0  0.0  0.0  0.0  0.0  2.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  2.0  0.0  1.0  0.0  0.0  1.0  …  1.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  1.0  1.0  0.0  0.0  0.0  1.0     1.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  2.0  1.0  0.0  0.0  0.0  2.0     1.0  1.0  1.0  1.0  0.0  0.0  0.0
 0.0  0.0  2.0  0.0  0.0  0.0  0.0  2.0     0.0  0.0  0.0  0.0  0.0  0.0  0.0
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># actual memory usage of Matrix{Float64}</span>
<span class="n">Base</span><span class="o">.</span><span class="n">summarysize</span><span class="p">(</span><span class="n">hapmapf64</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>36101376
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># average maf of the hapmap3 data set</span>
<span class="n">mean</span><span class="p">(</span><span class="n">maf</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>0.222585591341583
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># estimated memory usage if convert to SparseMatrixCSC{Float32, UInt32} matrix</span>
<span class="n">estimatesize</span><span class="p">(</span><span class="n">people</span><span class="p">,</span> <span class="n">snps</span><span class="p">,</span> <span class="kt">SparseMatrixCSC</span><span class="p">{</span><span class="kt">Float32</span><span class="p">,</span> <span class="kt">UInt32</span><span class="p">},</span> <span class="n">mean</span><span class="p">(</span><span class="n">maf</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span>1.4338389205819245e7
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># convert to SparseMatrixCSC{Float32, UInt32} matrix</span>
<span class="n">hapmapf32sp</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="kt">SparseMatrixCSC</span><span class="p">{</span><span class="kt">Float32</span><span class="p">,</span> <span class="kt">UInt32</span><span class="p">},</span> <span class="n">hapmap</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>324×13928 SparseMatrixCSC{Float32,UInt32} with 1614876 stored entries:
  [2    ,     2]  =  1.0
  [6    ,     2]  =  1.0
  [15   ,     2]  =  1.0
  [31   ,     2]  =  1.0
  [33   ,     2]  =  1.0
  [35   ,     2]  =  1.0
  [43   ,     2]  =  1.0
  [44   ,     2]  =  1.0
  [50   ,     2]  =  1.0
  [54   ,     2]  =  1.0
  ⋮
  [135  , 13927]  =  1.0
  [148  , 13927]  =  1.0
  [160  , 13927]  =  1.0
  [164  , 13927]  =  2.0
  [167  , 13927]  =  1.0
  [185  , 13927]  =  1.0
  [266  , 13927]  =  1.0
  [280  , 13927]  =  1.0
  [288  , 13927]  =  1.0
  [118  , 13928]  =  2.0
  [231  , 13928]  =  2.0
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># actual memory usage if convert to SparseMatrixCSC{Float32, UInt32} matrix</span>
<span class="n">Base</span><span class="o">.</span><span class="n">summarysize</span><span class="p">(</span><span class="n">hapmapf32sp</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>12974764
</pre></div>


<p>By default the <code>convert()</code> method converts missing genotypes to <code>NaN</code>.</p>
<div class="codehilite"><pre><span></span><span class="c"># number of missing genotypes</span>
<span class="n">countnz</span><span class="p">(</span><span class="n">isnan</span><span class="o">.</span><span class="p">(</span><span class="n">hapmap</span><span class="p">)),</span> <span class="n">countnz</span><span class="p">(</span><span class="n">isnan</span><span class="o">.</span><span class="p">(</span><span class="n">hapmapf64</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span>(11894, 11894)
</pre></div>


<p>One can enforce <strong>crude imputation</strong> by setting the optional argument <code>impute=true</code>. Imputation is done by generating two random alleles according to the minor allele frequency. This is a neutral but not an optimal strategy, and users should impute missing genotypes by more advanced methods.</p>
<div class="codehilite"><pre><span></span><span class="n">hapmapf64impute</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="kt">Matrix</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span> <span class="n">hapmap</span><span class="p">;</span> <span class="n">impute</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
<span class="n">countnz</span><span class="p">(</span><span class="n">isnan</span><span class="o">.</span><span class="p">(</span><span class="n">hapmapf64impute</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span>0
</pre></div>


<p>By default <code>convert()</code> translates genotypes according to the <em>additive</em> SNP model, which essentially counts the number of <strong>minor allele</strong> (0, 1 or 2) per genotype. Other SNP models are <em>dominant</em> and <em>recessive</em>, both in terms of the <strong>minor allele</strong>. When <code>A1</code> is the minor allele, genotypes are translated to real number according to</p>
<table>
<thead>
<tr>
<th align="center">Genotype</th>
<th align="center"><code>SnpArray</code></th>
<th align="center"><code>model=:additive</code></th>
<th align="center"><code>model=:dominant</code></th>
<th align="center"><code>model=:recessive</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">A1,A1</td>
<td align="center">(false,false)</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">A1,A2</td>
<td align="center">(false,true)</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">A2,A2</td>
<td align="center">(true,true)</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">missing</td>
<td align="center">(true,false)</td>
<td align="center">NaN</td>
<td align="center">NaN</td>
<td align="center">NaN</td>
</tr>
</tbody>
</table>
<p>When <code>A2</code> is the minor allele, genotypes are translated according to</p>
<table>
<thead>
<tr>
<th align="center">Genotype</th>
<th align="center"><code>SnpArray</code></th>
<th align="center"><code>model=:additive</code></th>
<th align="center"><code>model=:dominant</code></th>
<th align="center"><code>model=:recessive</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">A1,A1</td>
<td align="center">(false,false)</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">A1,A2</td>
<td align="center">(false,true)</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">A2,A2</td>
<td align="center">(true,true)</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">missing</td>
<td align="center">(true,false)</td>
<td align="center">NaN</td>
<td align="center">NaN</td>
<td align="center">NaN</td>
</tr>
</tbody>
</table>
<div class="codehilite"><pre><span></span><span class="p">[</span><span class="n">convert</span><span class="p">(</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span> <span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span> <span class="n">model</span> <span class="o">=</span> <span class="o">:</span><span class="n">additive</span><span class="p">)</span> <span class="n">convert</span><span class="p">(</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span> <span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span> <span class="n">model</span> <span class="o">=</span> <span class="o">:</span><span class="n">dominant</span><span class="p">)</span> <span class="n">convert</span><span class="p">(</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span> <span class="n">hapmap</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span> <span class="n">model</span> <span class="o">=</span> <span class="o">:</span><span class="n">recessive</span><span class="p">)]</span>
</pre></div>


<div class="codehilite"><pre><span></span>10×3 Array{Float64,2}:
 0.0  0.0  0.0
 0.0  0.0  0.0
 1.0  1.0  0.0
 1.0  1.0  0.0
 0.0  0.0  0.0
 2.0  1.0  1.0
 2.0  1.0  1.0
 0.0  0.0  0.0
 0.0  0.0  0.0
 0.0  0.0  0.0
</pre></div>


<p>By default <code>convert()</code> does <strong>not</strong> center and scale genotypes. Setting the optional arguments <code>center=true, scale=true</code> centers genotypes at 2MAF and scales them by $[2 \cdot \text{MAF} \cdot (1 - \text{MAF})]^{-1/2}$. Mono-allelic SNPs (MAF=0) are not scaled.</p>
<div class="codehilite"><pre><span></span><span class="p">[</span><span class="n">convert</span><span class="p">(</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span> <span class="n">hapmap</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="n">convert</span><span class="p">(</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Float64</span><span class="p">},</span> <span class="n">hapmap</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span> <span class="n">center</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)]</span>
</pre></div>


<div class="codehilite"><pre><span></span>324×2 Array{Float64,2}:
 0.0  -1.25702 
 0.0  -1.25702 
 1.0   0.167017
 1.0   0.167017
 0.0  -1.25702 
 2.0   1.59106 
 2.0   1.59106 
 0.0  -1.25702 
 0.0  -1.25702 
 0.0  -1.25702 
 0.0  -1.25702 
 0.0  -1.25702 
 1.0   0.167017
 ⋮             
 2.0   1.59106 
 0.0  -1.25702 
 1.0   0.167017
 0.0  -1.25702 
 0.0  -1.25702 
 0.0  -1.25702 
 0.0  -1.25702 
 0.0  -1.25702 
 1.0   0.167017
 0.0  -1.25702 
 0.0  -1.25702 
 0.0  -1.25702
</pre></div>


<p><code>copy!()</code> is the in-place version of <code>convert()</code>. Options such as GWAS loop over SNPs and perform statistical anlaysis for each SNP. This can be achieved by</p>
<div class="codehilite"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">snps</span>
    <span class="n">copy!</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">hapmap</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="n">j</span><span class="p">];</span> <span class="n">model</span> <span class="o">=</span> <span class="o">:</span><span class="n">additive</span><span class="p">,</span> <span class="n">impute</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
    <span class="c"># do statistical anlaysis</span>
<span class="k">end</span>
</pre></div>


<p><a id='Empirical-kinship-matrix-1'></a></p>
<h2 id="empirical-kinship-matrix">Empirical kinship matrix</h2>
<p><code>grm</code> function computes the empirical kinship matrix using either the genetic relationship matrix, <code>grm(A, model=:GRM)</code>, or the method of moment method, <code>grm(A, model=:MoM)</code>. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Missing genotypes are imputed according to minor allele frequencies on the fly.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is often necessary to filter SNPs according to minor allele frequency and LD before calculating empirical kinship matrix.</p>
</div>
<p>By default, <code>grm</code> exlcude SNPs with minor allele frequency below 0.01. This can be changed by the keyword argument <code>maf_threshold</code>.</p>
<div class="codehilite"><pre><span></span><span class="c"># GRM using all SNPs with MAF ≥ 0.01. Same as</span>
<span class="c"># grm(hapmap; maf_threshold = 0.01)</span>
<span class="n">grm</span><span class="p">(</span><span class="n">hapmap</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>324×324 Array{Float64,2}:
 0.571458   0.0464311  0.0199551  …  0.065172   0.0719459  0.0653116
 0.0464311  0.544725   0.0282826     0.0512752  0.0449652  0.0631871
 0.0199551  0.0282826  0.520116      0.046552   0.0305444  0.0366185
 0.0485422  0.0370034  0.0294222     0.0600245  0.0658291  0.0599777
 0.0527247  0.0428915  0.0250871     0.0716037  0.0587246  0.0657509
 0.0449014  0.0324916  0.0392128  …  0.0705846  0.0570837  0.0653063
 0.0395131  0.0224096  0.0118297     0.0444225  0.0383403  0.0372241
 0.0414288  0.0385228  0.0216014     0.0578062  0.0549297  0.0663108
 0.0302047  0.0311982  0.0167017     0.03367    0.04633    0.0380357
 0.0391444  0.0420736  0.0262111     0.0667603  0.057535   0.048993 
 0.0483412  0.0453938  0.0229784  …  0.0586796  0.0629187  0.0611821
 0.0607361  0.0386021  0.0373459     0.0661212  0.0586743  0.0698014
 0.036619   0.0441432  0.0266479     0.0574166  0.06993    0.0636137
 ⋮                                ⋱                                 
 0.057858   0.0550421  0.0385672     0.0862127  0.0867892  0.0968649
 0.0670946  0.051947   0.0329633     0.0918435  0.0803133  0.0861184
 0.06812    0.056159   0.038998      0.0898582  0.0848113  0.0854561
 0.0654276  0.0568588  0.0393993  …  0.0874573  0.0767071  0.089505 
 0.063116   0.056254   0.0357547     0.0785316  0.073411   0.0817352
 0.064895   0.0609217  0.0399485     0.0886267  0.0902875  0.0813491
 0.0623362  0.0601209  0.0385246     0.0822759  0.0841088  0.0810898
 0.0618955  0.0630099  0.0332965     0.0933279  0.0898342  0.0863454
 0.066011   0.063046   0.0324327  …  0.0972288  0.0795694  0.0866725
 0.065172   0.0512752  0.046552      0.603114   0.0821105  0.0903747
 0.0719459  0.0449652  0.0305444     0.0821105  0.595455   0.0825498
 0.0653116  0.0631871  0.0366185     0.0903747  0.0825498  0.582903
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># GRM using all SNPs with MAF ≥ 0.05</span>
<span class="n">grm</span><span class="p">(</span><span class="n">hapmap</span><span class="p">;</span> <span class="n">maf_threshold</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>324×324 Array{Float64,2}:
 0.569655   0.0533259  0.0238227  …  0.0733238  0.0773046  0.0725078
 0.0533259  0.543035   0.0292765     0.0565683  0.0502522  0.0689859
 0.0238227  0.0292765  0.521168      0.0523316  0.0353608  0.0407409
 0.0530866  0.0402229  0.0320051     0.0619395  0.072497   0.0651918
 0.0558751  0.045637   0.0260024     0.0764646  0.0639329  0.0724448
 0.0487862  0.0324028  0.0414961  …  0.075731   0.0607731  0.0646571
 0.0425807  0.0259461  0.0158766     0.0469247  0.0383466  0.0437265
 0.0445209  0.0415715  0.0246058     0.0574699  0.0568312  0.0665313
 0.0313927  0.0335657  0.01984       0.0369867  0.0502879  0.0415424
 0.0419546  0.0443697  0.02947       0.0709567  0.0633844  0.0528883
 0.0547824  0.0481855  0.024218   …  0.0626619  0.0685641  0.0672536
 0.0668034  0.0429604  0.0412379     0.0736168  0.0656362  0.0739072
 0.0361395  0.0472199  0.0295056     0.0632602  0.0731142  0.0671983
 ⋮                                ⋱                                 
 0.0604711  0.0578328  0.0430631     0.0922183  0.092174   0.105441 
 0.0719807  0.0549142  0.0378689     0.0980107  0.0858935  0.0927524
 0.0675168  0.0597127  0.0417714     0.0923096  0.0912273  0.0915402
 0.0705962  0.0636391  0.0453237  …  0.0942765  0.0835207  0.093857 
 0.0698496  0.0590258  0.0398921     0.0863023  0.081476   0.0898919
 0.0695019  0.0642225  0.0446517     0.0941713  0.0955554  0.088804 
 0.0672219  0.0627248  0.040251      0.0852741  0.0894345  0.0869601
 0.069019   0.0682414  0.0396043     0.0996116  0.092133   0.0865049
 0.0722643  0.0673632  0.0387407  …  0.106599   0.0842294  0.0901445
 0.0733238  0.0565683  0.0523316     0.590262   0.0897775  0.0944278
 0.0773046  0.0502522  0.0353608     0.0897775  0.587805   0.0880512
 0.0725078  0.0689859  0.0407409     0.0944278  0.0880512  0.570448
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># GRM using every other SNP, with maf ≥ 0.01</span>
<span class="n">grm</span><span class="p">(</span><span class="n">view</span><span class="p">(</span><span class="n">hapmap</span><span class="p">,</span> <span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">snps</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span>324×324 Array{Float64,2}:
 0.558675   0.0431596  0.0281906  …  0.0678361  0.0737569  0.0678428
 0.0431596  0.557339   0.0288423     0.0584065  0.0460293  0.0559139
 0.0281906  0.0288423  0.512262      0.0404619  0.0395088  0.047475 
 0.0454521  0.0464444  0.0267929     0.0518465  0.0617595  0.0566491
 0.0523056  0.0499494  0.0265126     0.0678693  0.0567765  0.0654963
 0.0524025  0.0409955  0.0405314  …  0.0769924  0.0626306  0.0530175
 0.0396371  0.0266048  0.0170996     0.0472069  0.0345508  0.0343661
 0.0473392  0.0388329  0.0270152     0.059386   0.0558696  0.0688371
 0.0266013  0.0237236  0.0193008     0.033394   0.043639   0.0361471
 0.0320554  0.0396779  0.0241781     0.0599865  0.0410583  0.0504274
 0.0491539  0.0504333  0.0210508  …  0.0629897  0.0652705  0.0533614
 0.0620909  0.0497012  0.0414584     0.0667277  0.0650775  0.0609132
 0.0250203  0.0432866  0.0219478     0.0547627  0.0687206  0.0634917
 ⋮                                ⋱                                 
 0.0610989  0.0504615  0.0411155     0.0871821  0.0857404  0.102135 
 0.0667531  0.0606607  0.03117       0.0898112  0.0760716  0.0812821
 0.0695847  0.0541784  0.0394035     0.0848243  0.0817369  0.0958491
 0.0656943  0.0586907  0.0406232  …  0.0935051  0.0763204  0.0827709
 0.0639221  0.0619239  0.0409911     0.0730449  0.069307   0.087749 
 0.0666386  0.0638029  0.0420165     0.0764784  0.0830993  0.0850801
 0.0639109  0.0642512  0.0320533     0.0867362  0.0932944  0.0844009
 0.0604671  0.0619833  0.0347137     0.09504    0.0918656  0.0838407
 0.0766471  0.0665513  0.0397895  …  0.102109   0.0746396  0.0900517
 0.0678361  0.0584065  0.0404619     0.573673   0.0698129  0.0958643
 0.0737569  0.0460293  0.0395088     0.0698129  0.576771   0.0746628
 0.0678428  0.0559139  0.047475      0.0958643  0.0746628  0.588228
</pre></div>


<div class="codehilite"><pre><span></span><span class="c"># MoM using all SNPs with MAF ≥ 0.01</span>
<span class="n">grm</span><span class="p">(</span><span class="n">hapmap</span><span class="p">;</span> <span class="n">method</span> <span class="o">=</span> <span class="o">:</span><span class="n">MoM</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>324×324 Array{Float64,2}:
 0.539321    0.0355051  0.00253189  …  0.0538235  0.0633964  0.0511053
 0.0355051   0.518284   0.0147048      0.0423597  0.0397597  0.0508689
 0.00253189  0.0147048  0.499257       0.0324323  0.0214412  0.0201412
 0.0434234   0.0292413  0.0235685      0.0526417  0.0694237  0.0500416
 0.0454325   0.0339687  0.0162412      0.0662328  0.057369   0.0568963
 0.0317232   0.0204958  0.0262868   …  0.0592599  0.0500416  0.0492143
 0.0249867   0.0113956  0.00359554     0.0317232  0.0310141  0.0252231
 0.0261686   0.0285322  0.00974108     0.0384596  0.0463779  0.0469689
 0.0217958   0.0266413  0.014823       0.0299504  0.0493325  0.0307777
 0.0215594   0.0256958  0.0109229      0.0529962  0.0508689  0.0325505
 0.0357414   0.0333778  0.00584102  …  0.0495689  0.056069   0.050278 
 0.0473234   0.0321959  0.027114       0.0550053  0.0550053  0.0518144
 0.031605    0.0425961  0.0254595      0.0587872  0.0706055  0.0580781
 ⋮                                  ⋱                                 
 0.041887    0.0420052  0.0264049      0.0713146  0.0789966  0.0824239
 0.0622145   0.0480325  0.027705       0.0917604  0.0792329  0.0836057
 0.054769    0.0459052  0.0265231      0.0807693  0.0815966  0.0727328
 0.0449597   0.0429506  0.0241595   …  0.0727328  0.0626873  0.070251 
 0.0564235   0.052878   0.0291232      0.0772238  0.0707237  0.0742692
 0.0533508   0.0551235  0.0313686      0.0794693  0.0865603  0.0719056
 0.0519326   0.050278   0.0285322      0.0771056  0.0827784  0.0733238
 0.0488598   0.0527598  0.0209685      0.0823057  0.0841966  0.0723783
 0.0506325   0.047678   0.0217958   …  0.087624   0.0734419  0.068951 
 0.0538235   0.0423597  0.0324323      0.561185   0.0811239  0.0763965
 0.0633964   0.0397597  0.0214412      0.0811239  0.566858   0.0691873
 0.0511053   0.0508689  0.0201412      0.0763965  0.0691873  0.533648
</pre></div>


<p><a id='Principal-components-1'></a></p>
<h2 id="principal-components">Principal components</h2>
<p>Principal compoenent analysis is widely used in genome-wide association analysis (GWAS) for adjusting population substructure. <code>pca(A, pcs)</code> computes the top <code>pcs</code> principal components of a <code>SnpArray</code>. Each SNP is centered at $2\text{MAF}$ and scaled by $[2\text{MAF}(1-\text{MAF})]^{-1/2}$. The output is  </p>
<ul>
<li><code>pcscore</code>: top <code>pcs</code> eigen-SNPs, or principal scores, in each column</li>
<li><code>pcloading</code>: top <code>pcs</code> eigen-vectors, or principal loadings, in each column</li>
<li><code>pcvariance</code>: top <code>pcs</code> eigen-values, or principal variances</li>
</ul>
<p>Missing genotypes are imputed according the minor allele frequencies on the fly. This implies that, in the presence of missing genotypes, running the function on the same <code>SnpArray</code> twice may produce slightly different answers. For reproducibility, it is a good practice to set the random seed before each function that does imputation on the fly.</p>
<div class="codehilite"><pre><span></span><span class="n">srand</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span> <span class="c"># set seed</span>
<span class="n">pcscore</span><span class="p">,</span> <span class="n">pcloading</span><span class="p">,</span> <span class="n">pcvariance</span> <span class="o">=</span> <span class="n">pca</span><span class="p">(</span><span class="n">hapmap</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>([-38.7231 -1.2983 -7.00541; -32.6096 -1.21052 -3.3232; … ; -48.9263 -2.06102 2.17374; -48.8627 0.274894 6.49518], [2.56616e-19 8.19569e-19 5.52006e-19; 0.00143962 -0.0042375 -0.00311816; … ; 0.00313326 -0.00427486 -0.0152038; -9.09523e-5 -0.00287777 0.0037855], [1841.4, 225.324, 70.7084])
</pre></div>


<p>To use eigen-SNPs for plotting or as covariates in GWAS, we typically scale them by their standard deviations so that they have mean zero and unit variance.</p>
<div class="codehilite"><pre><span></span><span class="c"># standardize eigen-SNPs before plotting or GWAS</span>
<span class="n">scale!</span><span class="p">(</span><span class="n">pcscore</span><span class="p">,</span> <span class="mi">1</span> <span class="o">./</span> <span class="n">sqrt</span><span class="o">.</span><span class="p">(</span><span class="n">pcvariance</span><span class="p">))</span>
<span class="n">std</span><span class="p">(</span><span class="n">pcscore</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>1×3 Array{Float64,2}:
 1.0  1.0  1.0
</pre></div>


<p>Internally <code>pca</code> converts <code>SnpArray</code> to the matrix of minor allele counts. The default format is <code>Matrix{Float64}</code>, which can easily exceed memory limit. Users have several options when the default <code>Matrix{Float64}</code> cannot fit into memory.  </p>
<ul>
<li>Use other intermediate matrix types.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c"># use single precision matrix and display the principal variances</span>
<span class="c"># approximately same answer as double precision</span>
<span class="n">srand</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">pca</span><span class="p">(</span><span class="n">hapmap</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kt">Matrix</span><span class="p">{</span><span class="kt">Float32</span><span class="p">})[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>3-element Array{Float32,1}:
 1841.39  
  225.324 
   70.7084
</pre></div>


<ul>
<li>Use subset of SNPs</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c"># principal components using every other SNP capture about half the variance</span>
<span class="n">srand</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">pca</span><span class="p">(</span><span class="n">view</span><span class="p">(</span><span class="n">hapmap</span><span class="p">,</span> <span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">snps</span><span class="p">),</span> <span class="mi">3</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>3-element Array{Float64,1}:
 926.622 
 113.188 
  36.4866
</pre></div>


<ul>
<li>Use sparse matrix. For large data sets with majority of rare variants, <code>pca_sp</code> is more efficient by first converting <code>SnpArray</code> to a sparse matrix (default is <code>SparseMatrixCSC{Float64, Int64}</code>) and then computing principal components using iterative algorithms.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c"># approximately same answer if we use Float16 sparse matrix</span>
<span class="n">srand</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">pca_sp</span><span class="p">(</span><span class="n">hapmap</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kt">SparseMatrixCSC</span><span class="p">{</span><span class="kt">Float32</span><span class="p">,</span> <span class="kt">UInt32</span><span class="p">})[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span>3-element Array{Float32,1}:
 1841.39  
  225.324 
   70.7084
</pre></div>


<p><a id='Linear-algebra-with-SnpArray-1'></a></p>
<h2 id="linear-algebra-with-snparray">Linear algebra with SnpArray</h2>
<p>In some applications we want to perform linear algebra using SnpArray directly without expanding it to numeric matrix. The implementation assumes:  </p>
<ol>
<li>the SnpArray does not have missing genotypes, and</li>
<li>the matrix corresponding to SnpArray is the matrix of A2 allele counts.</li>
</ol>
<div class="codehilite"><pre><span></span><span class="c"># generate a random SnpArray according to A2 allele counts</span>
<span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">SnpArray</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">0</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span>100×200 SnpArrays.SnpArray{2}:
 (false, false)  (false, false)  …  (false, false)  (false, false)
 (true, true)    (false, true)      (false, false)  (false, false)
 (false, true)   (false, true)      (true, true)    (false, true) 
 (false, false)  (true, true)       (false, false)  (false, false)
 (true, true)    (false, true)      (true, true)    (false, true) 
 (false, false)  (true, true)    …  (false, false)  (false, false)
 (true, true)    (false, true)      (false, false)  (false, true) 
 (false, false)  (false, true)      (false, true)   (true, true)  
 (false, true)   (false, true)      (false, false)  (true, true)  
 (false, false)  (false, true)      (false, true)   (false, false)
 (false, true)   (false, true)   …  (true, true)    (false, false)
 (false, true)   (true, true)       (false, false)  (false, true) 
 (false, false)  (false, false)     (true, true)    (false, true) 
 ⋮                               ⋱                                
 (false, true)   (false, false)     (true, true)    (false, false)
 (true, true)    (false, false)     (false, true)   (true, true)  
 (false, false)  (false, true)   …  (true, true)    (false, false)
 (false, true)   (false, true)      (false, true)   (true, true)  
 (false, false)  (false, false)     (false, true)   (false, true) 
 (false, true)   (false, true)      (false, true)   (false, true) 
 (false, false)  (true, true)       (true, true)    (false, false)
 (true, true)    (true, true)    …  (false, true)   (false, true) 
 (false, true)   (false, false)     (false, true)   (true, true)  
 (false, true)   (false, false)     (false, false)  (false, true) 
 (true, true)    (false, false)     (false, false)  (true, true)  
 (false, false)  (false, true)      (false, true)   (false, false)
</pre></div>


<ul>
<li>(snparray)-vector multiplications</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">S</span> <span class="o">*</span> <span class="n">randn</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>100-element Array{Float64,1}:
 30.615   
 -7.4687  
 23.0195  
  0.817897
 11.5828  
 18.367   
  2.00545 
 23.3611  
 17.7711  
 15.1654  
 12.0407  
 16.3625  
 10.5148  
  ⋮       
 18.9264  
 18.157   
 31.7193  
 23.6554  
 15.2196  
 25.8444  
 12.3667  
 12.3029  
 22.1251  
  5.91216 
 24.2695  
 15.3415
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">S</span><span class="o">.&#39;</span> <span class="o">*</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>200-element Array{Float64,1}:
 23.6847 
  4.66243
  4.61544
  2.69455
 22.525  
  9.71594
 21.4546 
 14.8832 
 21.4642 
  8.61231
 29.6248 
 14.1352 
  9.6956 
  ⋮      
 11.3634 
 14.6797 
 15.4163 
  6.77538
 27.3312 
 17.3787 
 26.6867 
 10.2509 
 15.9798 
 25.6015 
 16.2479 
  8.16274
</pre></div>


<ul>
<li>(snparray)-matrix or matrix-(snparray) multiplications</li>
</ul>
<div class="codehilite"><pre><span></span><span class="n">S</span> <span class="o">*</span> <span class="n">randn</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>100×3 Array{Float64,2}:
  -1.60062   -10.8268      5.49057 
  -9.34748     6.34819     2.06767 
   4.05002     0.325131    4.77423 
   2.9358      8.0825     -0.397737
  -5.35414   -21.3731     -1.43909 
  26.4514     -3.9009      4.35974 
   8.90361    -6.01847    11.1584  
   2.85343     0.083285    9.52995 
   2.49824    -9.35725    -3.95109 
  -0.562102  -10.0496     16.7451  
   8.27958     3.54241     2.29453 
  20.7223     -7.09494   -10.1341  
 -12.3776     -1.14019     9.97014 
   ⋮                               
  11.6659      5.81297   -35.0418  
  -6.66734   -11.7336     27.3868  
   2.32574    19.9981     22.9892  
  33.9357     -5.73126    14.894   
   0.826793   -2.0143     11.4629  
   3.18468    -6.91367     2.78527 
   5.86711     3.62248    -7.05016 
   8.42888   -16.9377     -1.87953 
  -7.8737    -10.6408      2.33838 
  -8.03682    -0.736084   10.3781  
   9.1461      8.01083    10.4097  
   8.92717    -5.15705     9.71163
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">S</span><span class="o">.&#39;</span> <span class="o">*</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span>200×3 Array{Float64,2}:
 -10.6349    -19.693    -13.2774  
  -0.526305  -21.8054   -17.4738  
  -9.04862    -8.15163  -25.224   
  -3.3977    -13.7849   -16.0947  
 -10.4237    -14.0344   -14.4495  
   6.00368   -24.9057   -20.0696  
  -6.00073   -18.1709   -36.9535  
  -6.71766   -20.1876   -25.332   
 -13.1678    -22.5888   -14.3297  
   2.01221    -2.28132  -35.2057  
  -5.33609    -4.39915  -24.1266  
  -5.07446   -19.7707    -2.23233 
 -13.4401    -22.1923    -0.959362
   ⋮                              
 -12.2891     -9.20109   -4.10673 
  10.428     -13.5418   -28.1259  
 -15.5509    -23.4182   -17.6246  
  -2.16756   -33.9645    -7.70753 
 -27.8904     -4.51243  -10.2176  
 -12.3735    -29.4709   -23.3459  
 -11.7062     -9.69129  -32.2018  
  -9.16911   -29.8954   -10.581   
  -6.58973   -38.5497   -11.1196  
 -16.7095    -24.4645   -21.6888  
  -4.09502   -22.2393   -10.9904  
  -7.70413   -19.7018   -10.8812
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span>
</pre></div>


<div class="codehilite"><pre><span></span>3×200 Array{Any,2}:
 25.8644    11.7117   3.94609  -9.07055  …  7.97652   9.36757   9.80563
  6.44405    9.15611  5.61898  17.9318      8.86161  18.4627   23.2194 
 -7.09806  -13.1394   5.01518  -1.44749     1.2617   13.6327   -2.06252
</pre></div>


<p>The in-place version of matrix-(vector/matrix) multiplication functions are also available: <code>A_mul_B!</code>, <code>At_mul_Bt!</code>, <code>A_mul_Bt!</code>, <code>At_mul_B!</code>, <code>Ac_mul_B!</code>, <code>A_mul_Bc!</code>, <code>Ac_mul_Bc!</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">o</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">randn</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="c"># the last optional argument is working parameter, which can preallocated to increase performance</span>
<span class="n">A_mul_B!</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">similar</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
</pre></div>


<div class="codehilite"><pre><span></span>100-element Array{Float64,1}:
 26.6472 
 29.4652 
 26.6715 
 20.8541 
 24.1833 
 24.5305 
 26.5941 
 27.9289 
 35.232  
 33.375  
 21.6101 
  8.81546
 11.4446 
  ⋮      
 20.4184 
 20.4023 
 -3.50685
 25.4039 
 24.7287 
 24.0314 
 23.5559 
 25.1384 
 29.4094 
 15.9748 
 27.7337 
 25.8975
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../.." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../snpdata/" title="SnpData" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                SnpData
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../assets/mathjaxhelper.js"></script>
      
    
    
      
    
  </body>
</html>